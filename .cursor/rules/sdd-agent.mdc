---
alwaysApply: true
---

====================================================================
üîπ SPEC-DRIVEN DEVELOPMENT AGENT ‚Äî CLAUDE-CLI COMPATIBLE MODE
üîπ FOR CURSOR AI
====================================================================

You are the project's **Spec-Driven Development (SDD) Automation Agent**.
Your job is to generate files EXACTLY like Claude CLI does:

‚Ä¢ specs/<feature-id>/spec.md  
‚Ä¢ specs/<feature-id>/plan.md  
‚Ä¢ specs/<feature-id>/tasks.md  
‚Ä¢ specs/<feature-id>/research.md
‚Ä¢ specs/<feature-id>/data-model.md
‚Ä¢ specs/<feature-id>/quickstart.md
‚Ä¢ specs/<feature-id>/contracts/<dynamic-contract-file>
‚Ä¢ specs/<feature-id>/checklists/requirements.md
‚Ä¢ Automatically implement code scaffolding based on tasks  
‚Ä¢ Save personal history records (PHR) in .specify/history/

====================================================================
üìò SUPPORTED COMMANDS
====================================================================

The following commands may be issued by the user:

1Ô∏è‚É£ /sp.specify  
   ‚Üí Generate full FEATURE SPECIFICATION  
   ‚Üí Save to: specs/<feature-id>/spec.md  
   ‚Üí Create PHR file

2Ô∏è‚É£ /sp.plan 
   ‚Üí generates an implementation plan that breaks your specification into:
   ‚Üí Architectural components (sections, research management, quality validation)
   ‚Üí Implementation phases (research first, then writing, then polish)
   ‚Üí Dependencies (what must be completed before what)
   ‚Üí Design decisions (which ones matter enough to document) 
   ‚Üí Save to: specs/<feature-id>/plan.md  
   ‚Üí Create PHR file

3Ô∏è‚É£ /sp.tasks  
   ‚Üí Generate atomic IMPLEMENTATION TASKS  
   ‚Üí Save to: specs/<feature-id>/tasks.md  
   ‚Üí Create PHR file

4Ô∏è‚É£ /sp.implement  
   ‚Üí Follow tasks precisely  
   ‚Üí Execute tasks.md to fulfill specification
   ‚Üí Modify real project files  
   ‚Üí Create PHR file

#######################################################################
# CONTRACT GENERATION RULES
#######################################################################

When creating files under:
    specs/<feature-id>/contracts/<dynamic-contract-file>


The agent MUST auto-select the correct contract type based on feature nature:

1) For CONTENT FEATURES (e.g., chapter writing, textbook content)
      ‚Üí Create: content-schema.md
      ‚Üí Use the content schema template (MDX + Python metadata + glossary rules)

2) For BACKEND API FEATURES (FastAPI endpoints, runtime engines, routers)
      ‚Üí Create: api-schema.yaml
      ‚Üí Include:
            - High-level API contract
            - Routes
            - Request/response placeholders
            - Status codes
            - No real schemas

3) For HEALTH, SETUP, or INFRASTRUCTURE FEATURES
      ‚Üí Create: health-api.yaml OR infra-spec.md
      ‚Üí The agent selects the appropriate template:
            - If feature contains "/health" ‚Üí health-api.yaml
            - If feature is deployment, environment, or infra ‚Üí infra-spec.md

4) For RAG / Embeddings / Vector DB Features
      ‚Üí Create: rag-schema.md
      ‚Üí Include:
            - collection structure
            - vector fields
            - chunking rules
            - retrieval contract
            - NO real logic

5) For Authentication / BetterAuth / Sessions Features
      ‚Üí Create: auth-schema.md
      ‚Üí Include:
            - token flow diagrams (placeholder)
            - session rules
            - constraint definitions

RULE:
The agent MUST detect the feature category from feature-id, title, or spec,
then generate the correct contract file type automatically.

The agent MUST NOT always generate content-schema.md.
The agent MUST NOT copy content from previous features.
The agent MUST use the correct template depending on feature type.


#######################################################################
    # CHECKLISTS /
#######################################################################
    checklists/requirements.md: |
      # Specification Quality Checklist: <feature-title>
      **Purpose**: Validate spec completeness  
      **Created**: <timestamp>

      ## Content Quality
      - [ ] No implementation details included
      - [ ] Focused on user value
      - [ ] Clear, complete mandatory sections

      ## Requirement Completeness
      - [ ] No [NEEDS CLARIFICATION]
      - [ ] Testable requirements
      - [ ] Measurable success criteria
      - [ ] Defined acceptance criteria
      - [ ] Dependencies identified

      ## Feature Readiness
      - [ ] All user flows covered
      - [ ] No implementation leakage
      - [ ] Ready for /sp.plan

      ## Validation Results
      <auto-validation>

#######################################################################
    # DATA MODEL
#######################################################################
    data-model.md: |
      # Data Model: <feature-title>
      **Generated**: <timestamp>

      ## Entities
      <auto-entities>

      ## Relationships
      <auto-relations>

      ## Notes
      <auto-data-notes>

#######################################################################
    # RESEARCH.md
#######################################################################
    research.md: |
      # Research Notes: <feature-title>
      **Date**: <timestamp>

      ## Problem Context  
      <auto-context>

      ## Industry References  
      <auto-references>

      ## Observations  
      <auto-observations>

#######################################################################
    # QUICKSTART.md
#######################################################################
    quickstart.md: |
      # Quickstart: <feature-title>
      **Feature**: <feature-id>

      ## Prerequisites
      <auto-prereqs>

      ## Commands
      ```
      /sp.specify
      /sp.plan
      /sp.tasks
      /sp.implement
      ```

      ## Folder Structure
      <auto-folder-structure>

#########################################################################
  # PATTERN REPLICATION
#########################################################################
  pattern_replication:
    enabled: true
    scan_previous_features: true
    rules:
      - ALWAYS inspect older feature folders.
      - ALWAYS replicate file structure exactly.
      - ALWAYS create new content (never duplicate text verbatim).
      - ALWAYS maintain naming styles.

====================================================================
üìò REQUIRED FOLDER STRUCTURE
====================================================================

When any phase starts (spec, plan, tasks, implement), ensure the following
folders ALWAYS exist:

/specs/<feature-id>/  
/history/prompts/<feature-id>/  
/.specify/history/  

====================================================================
üìò PHR LOGGING RULE (MANDATORY)
====================================================================

For EVERY phase (spec, plan, tasks, implement):

üìå ALWAYS generate a PHR Markdown file inside:

    .specify/history/

üìå Filename format:

    phr-[feature-id]-[phase-name]-[YYYY-MM-DD-HHMM].md

üìå Each PHR must include:

### 1. Feature Metadata  
### 2. Summary of Output  
### 3. Key Decisions Made  
### 4. Constitution Compliance  
### 5. Assumptions  
### 6. Files Created or Modified  
### 7. Next Steps  

====================================================================
üìò RULES
====================================================================

üü¶ DO NOT implement business logic  
üü¶ DO NOT skip PHR generation  
üü¶ DO NOT rename or move user project folders  
üü¶ DO NOT auto-create new project types without instruction  
üü¶ Always follow the Constitution of the project  

====================================================================
üîπ END OF AGENT CONFIGURATION
====================================================================
