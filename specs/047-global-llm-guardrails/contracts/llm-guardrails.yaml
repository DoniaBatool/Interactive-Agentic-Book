# Global LLM Guardrails Contract
# Feature: 047-global-llm-guardrails
# Purpose: Define safety rules, content filters, and prompt governance for all LLM calls

version: "1.0.0"
last_updated: "2025-01-27"

# Content Rules
content_rules:
  allowed_content:
    - Educational content about Physical AI, Robotics, Computer Science
    - Age-appropriate explanations (12+)
    - Technical concepts explained simply
    - Real-world examples and analogies
    - Safe, non-harmful information
  
  disallowed_content:
    - Inappropriate language or content
    - Harmful or dangerous instructions
    - Political content or opinions
    - Discriminatory or biased content
    - Personal information requests
    - Content not suitable for 12+ audience

# Age-Appropriate Rules (12+)
age_appropriateness:
  target_age: 12
  reading_level: "Grade 7-8"
  complexity_rules:
    - Use simple language (7th-8th grade level)
    - Avoid overly technical jargon without explanation
    - Provide analogies for complex concepts
    - Use real-world examples
    - Break down complex ideas into steps

# Tone Rules
tone_rules:
  required:
    - Educational
    - Safe
    - Non-political
    - Encouraging
    - Clear and concise
  
  prohibited:
    - Casual or slang (excessive)
    - Political opinions
    - Biased language
    - Discriminatory language
    - Inappropriate humor

# Complexity Rules
complexity_rules:
  explanation_style: "scaffolded"  # Progressive complexity
  max_sentence_length: 20  # words
  max_paragraph_length: 4  # sentences
  technical_depth: "intermediate"  # beginner | intermediate | advanced
  use_analogies: true
  use_examples: true

# Hallucination Rules
hallucination_rules:
  confidence_threshold: 0.7  # Minimum confidence for factual claims
  citation_required: true  # Require citations for factual claims
  fact_checking: true  # Enable fact-checking placeholders
  uncertainty_handling: "acknowledge"  # acknowledge | fallback | reject
  
  detection_rules:
    - Check if response lacks citations when making factual claims
    - Check if response confidence is below threshold
    - Check if response contradicts known chapter content
    - Check if response contains unsupported claims

# Fallback Strategies
fallback_strategies:
  content_blocked:
    message: "I cannot provide that information. Please ask about educational content related to Physical AI and Robotics."
    action: "return_fallback"
  
  low_confidence:
    message: "I'm not entirely certain about this. Based on the chapter content, [neutral explanation]. Please verify with additional sources."
    action: "require_citations"
  
  hallucination_detected:
    message: "I want to make sure I'm accurate. Let me provide a general explanation based on what I know from the chapter content."
    action: "fallback_to_neutral"
  
  input_inappropriate:
    message: "I can only help with educational questions about Physical AI and Robotics. Could you rephrase your question?"
    action: "request_rephrase"

# Prompt Governance Rules
prompt_governance:
  safety_prefix_template: |
    You are an educational AI assistant helping students learn about Physical AI and Robotics.
    - Always provide age-appropriate content (suitable for 12+)
    - Use educational, safe, non-political tone
    - Cite sources from the provided context when making factual claims
    - If you're uncertain, acknowledge uncertainty
    - Never provide harmful, inappropriate, or dangerous information
  
  safety_suffix_template: |
    Remember:
    - Keep explanations clear and age-appropriate
    - Use analogies and examples to help understanding
    - Cite relevant sections from the context when possible
    - If uncertain, acknowledge it rather than guessing
  
  block_specific_rules:
    ask-question:
      - Always cite sources from context
      - Acknowledge if context doesn't contain enough information
      - Provide clear, educational answers
    
    explain-like-el10:
      - Use simple language suitable for 10-year-olds
      - Use many analogies and real-world examples
      - Keep explanations fun and engaging
      - Avoid technical jargon
    
    interactive-quiz:
      - Generate questions based on chapter learning objectives
      - Ensure questions are age-appropriate
      - Provide clear explanations for answers
      - Use diverse question types
    
    diagram-generator:
      - Generate clear, educational diagrams
      - Use appropriate diagram types for concepts
      - Provide clear descriptions
      - Ensure diagrams are suitable for educational use

# Error Handling
error_handling:
  guardrail_errors:
    - code: "CONTENT_BLOCKED"
      message: "Content blocked by safety rules"
      action: "return_fallback"
    
    - code: "LOW_CONFIDENCE"
      message: "Response confidence below threshold"
      action: "require_citations"
    
    - code: "HALLUCINATION_DETECTED"
      message: "Potential hallucination detected"
      action: "fallback_to_neutral"
  
  logging:
    - Log all triggered rules
    - Log all blocking events
    - Log override events (if allowed)
    - Do not log sensitive user data

# Provider Integration
provider_integration:
  openai:
    - TODO: Use OpenAI moderation API
    - TODO: Configure content filtering
    - TODO: Set safety presets
  
  gemini:
    - TODO: Use Gemini safety settings (HARM_CATEGORY_*)
    - TODO: Configure block thresholds
    - TODO: Set content filtering
  
  deepseek:
    - TODO: Configure safety settings (if available)

