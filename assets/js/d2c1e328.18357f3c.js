"use strict";(globalThis.webpackChunkphysical_ai_robotics_book=globalThis.webpackChunkphysical_ai_robotics_book||[]).push([[675],{8118(e,i,s){s.r(i),s.d(i,{default:()=>o});var t=s(6540),a=s(6347),r=s(2360),n=s(9552),d=s(96),c=s(3),l=s(4848);function o(){const{user:e,loading:i}=(0,n.As)(),{t:s}=(0,d.B)(),o=(0,a.W6)(),[h,m]=(0,t.useState)([]),[u,x]=(0,t.useState)(!0),[j,p]=(0,t.useState)(null),f=c.DB;(0,t.useEffect)(()=>{if(!i&&e){e.isAdmin||"admin"===e.role||o.push("/")}},[e,i,o]),(0,t.useEffect)(()=>{e&&(e.isAdmin||"admin"===e.role)&&A()},[e]);const A=async()=>{try{x(!0),p(null);const e=await fetch(`${f}/api/auth/admin/users`,{credentials:"include"});if(!e.ok){let i="Failed to fetch users";try{const s=await e.json();i=s.error||s.message||i,console.error("Admin API error:",{status:e.status,statusText:e.statusText,error:s})}catch{i=`Server error: ${e.status} ${e.statusText}`}return void p(i)}const i=await e.json();m(i.users||[])}catch(e){console.error("Network error fetching users:",e),p(`Network error: ${e.message||"Please check if the server is running."}`)}finally{x(!1)}};return i||u?(0,l.jsx)(r.A,{title:"Admin Panel",children:(0,l.jsx)("div",{className:"auth-loading",children:s("common.loading")})}):!e||!e.isAdmin&&"admin"!==e.role?(0,l.jsx)(r.A,{title:"Access Denied",children:(0,l.jsx)("div",{className:"auth-container",children:(0,l.jsx)("div",{className:"auth-card",children:(0,l.jsx)("div",{className:"auth-error",children:"You don't have permission to access this page."})})})}):(0,l.jsx)(r.A,{title:"Admin Panel",description:"User management",children:(0,l.jsx)("div",{className:"auth-container",children:(0,l.jsxs)("div",{className:"auth-card",style:{maxWidth:"1200px"},children:[(0,l.jsxs)("div",{className:"auth-header",children:[(0,l.jsx)("h1",{children:"Admin Panel"}),(0,l.jsx)("p",{children:"Manage users and permissions"})]}),j&&(0,l.jsx)("div",{className:"auth-error",children:j}),(0,l.jsx)("div",{className:"admin-users-table",children:(0,l.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Email"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Verified"}),(0,l.jsx)("th",{children:"Role"}),(0,l.jsx)("th",{children:"Created"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:h.map(i=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:i.email}),(0,l.jsx)("td",{children:i.name||"-"}),(0,l.jsx)("td",{children:i.emailVerified?"\u2705":"\u274c"}),(0,l.jsx)("td",{children:i.isAdmin?"Admin":"User"}),(0,l.jsx)("td",{children:new Date(i.createdAt).toLocaleDateString()}),(0,l.jsxs)("td",{children:["donia1510aptech@gmail.com"!==i.email&&i.id!==e.id&&(0,l.jsx)("button",{onClick:()=>(async(e,i)=>{try{const s=await fetch(`${f}/api/auth/admin/users/${e}/toggle-admin`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({isAdmin:!i})});if(s.ok)A();else{const e=await s.json().catch(()=>({}));p(e.error||"Failed to update user")}}catch(s){p("Network error")}})(i.id,i.isAdmin),className:"auth-submit",style:{marginRight:"8px",padding:"4px 12px",fontSize:"14px"},children:i.isAdmin?"Remove Admin":"Make Admin"}),"donia1510aptech@gmail.com"===i.email&&(0,l.jsx)("span",{style:{color:"#666",fontSize:"12px"},children:"Protected Admin"}),i.id===e.id&&"donia1510aptech@gmail.com"!==i.email&&i.isAdmin&&(0,l.jsx)("span",{style:{color:"#666",fontSize:"12px"},children:"You (Admin)"}),i.id!==e.id&&"donia1510aptech@gmail.com"!==i.email&&(0,l.jsx)("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this user?"))try{const i=await fetch(`${f}/api/auth/admin/users/${e}`,{method:"DELETE",credentials:"include"});if(i.ok)A();else{const e=await i.json().catch(()=>({}));p(e.error||"Failed to delete user")}}catch(i){p("Network error")}})(i.id),className:"auth-submit",style:{padding:"4px 12px",fontSize:"14px",backgroundColor:"#dc3545"},children:"Delete"})]})]},i.id))})]})})]})})})}}}]);